kprochide — это загружаемый модуль ядра (LKM) для скрытия процессов из пользовательского пространства. Модуль может скрывать несколько процессов и динамически получать новые процессы для скрытия.

Метод работы kprochide заключается в замене функции, отвечающей за перебор каталогов в procfs.

        ----------------
        | ls -al /proc |
        ----------------
                |
                |   ls вызывает системный вызов getdents() для получения всех каталогов procfs.
                |
        ----------------------
        | getdents() syscall |
        ----------------------
                |
                |   Системный вызов getdents() получает функцию iterate_shared() procfs
                |   из его структуры file_operations.
                |
        --------------------
        | iterate_shared() |
        --------------------
                |
                |   Вызывается iterate_shared(), которая вызывает функцию filldir_t().
                |
        ---------------
        | filldir_t() |
        ---------------
        
Вызывается filldir_t(), отвечающая за список существующих каталогов.
Заменив функцию filldir() на свою собственную, мы получаем контроль над тем, какие каталоги видит пользователь. Когда наша новая функция вызывается с каталогом, представляющим процесс, который мы хотим скрыть, модуль "лжёт" пользовательскому режиму, говоря, что каталог не существует. 

Модуль использует символьное устройство для динамического получения PID'ов, которые нужно скрыть. Каждый новый PID сохраняется в глобальный связный список.

После выгрузки модуля он восстанавливает оригинальные функции procfs, отменяет регистрацию символьного устройства и очищает связный список.

$ git clone https://github.com/spiderpig1297/kprochide.git
$ cd kprochide
$ make
$ sudo insmod kprochide.ko

После запуска модуль записывает в лог основной номер (major number) зарегистрированного символьного устройства. Выполните dmesg, чтобы увидеть его, и mknod, чтобы создать узел устройства:

$ dmesg # Найдите major number
$ mknod /dev/readpid c <MAJOR_GOES_HERE> 0
echo <pid> > /dev/readpid

Теперь проверьте список запущенных процессов:

Та-да! Процесс скрыт.# new_rk
# new_rk
# new_rk
# trying_lkm
